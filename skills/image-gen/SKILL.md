---
name: image-gen
description: 当用户想要生成图片、画图、绘画、创建图像、AI作画时使用此 Skill。支持文生图、图生图，具备自动检查和修正功能。
---

# 图像生成 Skill

当用户表达画图意图时（如"画一个..."、"生成图片..."、"帮我创作..."），使用此 Skill。

## 核心特性

- **文生图**：根据文字描述生成图片
- **图生图**：基于参考图片生成新图
- **自动检查**：生成后自动检查图片是否符合要求
- **智能修正**：发现问题自动重新生成或微调

## 调用流程

### 1. 读取配置

读取 `config/secrets.md` 获取 API Key。

### 2. 构造 prompt

| 模式 | prompt 格式 | 示例 |
|-----|------------|------|
| 文生图 | `描述文字` | `一只可爱的橘猫在阳光下打盹` |
| 图生图 | `图片URL 描述文字` | `https://xxx.jpg 画成水彩风格` |
| 多图参考 | `URL1 URL2 描述文字` | `https://a.jpg https://b.jpg 融合两张图的风格` |

**图生图需先上传图片**，参考 `tips/image-upload.md`。

### 3. 调用 API

```bash
curl -s -X POST "https://api.apicore.ai/v1/images/generations" \
  -H "Authorization: Bearer API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "nano-banana-pro",
    "prompt": "提示词",
    "size": "1024x1024",
    "n": 1
  }'
```

**尺寸参数**：
- `1024x1024` - 正方形（默认）
- `1536x1024` - 横版 3:2
- `1024x1536` - 竖版 2:3
- `2048x2048` - 4K 高清

### 4. 返回结果

从响应中提取 `data[0].url` 展示给用户。

## 自动优化修正流程

### 第一阶段：生成后自检

生成图片后，**必须**执行以下检查：

1. **内容检查**：图片内容是否符合用户描述
2. **文字检查**：如包含文字，检查是否有错别字或乱码
3. **风格检查**：风格是否符合要求
4. **质量检查**：是否有明显瑕疵（模糊、变形等）

### 第二阶段：问题识别与修正

发现问题后，按以下策略处理：

| 问题类型 | 修正策略 | 最大重试次数 |
|---------|---------|-------------|
| 内容偏差大 | 优化提示词，重新生成 | 3 次 |
| 文字错误 | 使用图生图精确修正，参考 `tips/chinese-text.md` | 3 次 |
| 风格不符 | 调整风格关键词，重新生成 | 2 次 |
| 质量问题 | 调整参数或换模型，重新生成 | 2 次 |

### 第三阶段：经验沉淀

**重要**：每次成功的修正，都应该将经验更新到 `tips/` 目录：

1. 如果是文字相关问题 → 更新 `tips/chinese-text.md`
2. 如果是风格相关问题 → 更新 `tips/style-guide.md`
3. 如果是新发现的技巧 → 创建新的 tips 文件

## 提示词优化建议

为提高生成质量，自动应用以下优化：

1. **具体化描述**：模糊词替换为具体词（"好看的" → "光影柔和、色彩明亮的"）
2. **添加风格标签**：如用户未指定，可建议添加风格（写实、插画、水彩等）
3. **补充细节**：光线、角度、背景等细节描述
4. **中文文字处理**：包含中文时，强调"正确显示中文文字：XXX"

## 参考文档

- `tips/image-upload.md` - 图片上传方法
- `tips/chinese-text.md` - 中文文字处理技巧
- `tips/style-guide.md` - 风格指南与常用提示词
- `tips/troubleshooting.md` - 常见问题排查

## 使用示例

### 基础文生图
```
用户：画一只穿西装的猫
执行：调用 API，prompt="一只穿着黑色西装的橘猫，端坐姿态，写实风格，studio lighting"
检查：确认图片内容正确
返回：展示图片 URL
```

### 带文字的图片
```
用户：做一张封面，写上"2024年度总结"
执行：调用 API，prompt="现代简约风格封面设计，正确显示中文文字：「2024年度总结」"
检查：确认文字显示正确
修正：如文字有误，使用图生图修正
返回：展示最终图片
```

### 图生图修正
```
用户：这张图里"肥楼"应该是"爬楼"
执行：上传图片获取 URL，调用 API 修正
prompt="[图片URL] 将图中「肥」字改成「爬」字，变成「爬楼」，只改这一个字，其他部分完全不动"
检查：确认修正成功
返回：展示修正后的图片
```
